<script>
    // Format numbers as USD-style currency
    function formatCurrency(amount) {
        if (isNaN(amount) || !isFinite(amount)) return '$0';
        return '$' + Math.round(amount).toLocaleString();
    }

    document.getElementById('rateForm').addEventListener('submit', function (e) {
        e.preventDefault();

        // Get inputs
        const desiredIncome = parseFloat(document.getElementById('desiredIncome').value);
        const workWeeks = parseFloat(document.getElementById('workWeeks').value);
        const billableHours = parseFloat(document.getElementById('billableHours').value);
        const expenses = parseFloat(document.getElementById('expenses').value);
        const taxRate = parseFloat(document.getElementById('taxes').value) / 100;
        const profitMargin = parseFloat(document.getElementById('profitMargin').value) / 100;

        // Basic input validation
        if (
            isNaN(desiredIncome) || isNaN(workWeeks) || isNaN(billableHours) ||
            isNaN(expenses) || isNaN(taxRate) || isNaN(profitMargin) ||
            workWeeks <= 0 || billableHours <= 0
        ) {
            alert('⚠️ Please fill in all fields with valid numbers.');
            return;
        }

        // Total billable hours per year
        const totalHoursPerYear = workWeeks * billableHours;

        // ✅ Improved formula:
        // Gross Revenue = (Desired Income + Expenses) / (1 - taxRate - profitMargin)
        // This properly factors in taxes and profit margin.
        const grossRevenue = (desiredIncome + expenses) / (1 - taxRate - profitMargin);

        // Hourly rate
        const hourlyRate = grossRevenue / totalHoursPerYear;

        // Rate ranges (for context)
        const minRate = hourlyRate * 0.85;      // 15% lower
        const premiumRate = hourlyRate * 1.25;  // 25% higher

        // Breakdown values
        const taxes = grossRevenue * taxRate;
        const profit = grossRevenue * profitMargin;
        const takeHome = desiredIncome;

        // Update UI
        document.getElementById('hourlyRate').textContent = formatCurrency(hourlyRate) + '/hr';
        document.getElementById('minRate').textContent = formatCurrency(minRate) + '/hr';
        document.getElementById('targetRate').textContent = formatCurrency(hourlyRate) + '/hr';
        document.getElementById('premiumRate').textContent = formatCurrency(premiumRate) + '/hr';

        document.getElementById('grossRevenue').textContent = formatCurrency(grossRevenue);
        document.getElementById('takeHome').textContent = formatCurrency(takeHome);
        document.getElementById('expensesValue').textContent = formatCurrency(expenses);
        document.getElementById('taxesValue').textContent = formatCurrency(taxes);
        document.getElementById('profitValue').textContent = formatCurrency(profit);
        document.getElementById('totalHours').textContent = Math.round(totalHoursPerYear) + ' hours';

        // Show results smoothly
        const results = document.getElementById('results');
        if (!results.classList.contains('show')) {
            results.classList.add('show');
        }
        results.scrollIntoView({ behavior: 'smooth', block: 'nearest' });
    });
</script>
